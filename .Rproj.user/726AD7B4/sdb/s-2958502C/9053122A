{
    "contents" : "#' Plot traces of posterior draws of a parameter\n#'\n#' Plots the posterior draws of a specified parameter by MCMC iteration with options for visual differentiation of separate chains.\n#' @param postob An array containing posterior draws from a \\code{bnps} model fit or \\code{rstan::stan} model fit.  Model fit objects of type 'stanfit' can be coerced into arrays using either the 'extract' or 'as.array' functions from the \\code{rstan} package.\n#' @param vname Name of variable to plot.  Name must correspond to a dimname in the array.\n#' @param pscale Plotting scale. Options are 'original', 'log', or 'inv' (inverse).\n#' @param stack Indicator to plot chains separately and stack the plots.\n#' @param colset Color scheme for plotting traces by chain.  Schemes 'color' and 'gray' will produce separate colors or gray shades for each chain, and scheme 'black' will make all chain traces black.\n#' @return Returns a plot object\n#' @export\n\n\nplot_trace <- function(postob, vname, pscale=\"original\", stack=FALSE, colset=\"color\"){\n\n   # Error checks\n   if (missing(postob)) stop(\"Need to specify object containing posterior draws.\")\n   if (class(postob)!=\"array\") stop(\"Posterior draws must be stored in an array.  See 'extract' or 'as.array' functions in rstan.\")\n   ## add check for vname specification - must be a character and be in dimnames of postob\n   if (missing(vname)) stop(\"Need to specify variable name of parameter to plot.\")\n   if (!(vname %in% dimnames(postob)$par)) stop(\"Variable name must be a parameter name in postob.\")\n   if (!(pscale %in% c(\"original\", \"log\", \"inv\"))) stop(\"Check specification of 'pscale'. Must be either 'original', 'log', or 'inv'.\")\n   if (!(colset %in% c(\"color\", \"gray\", \"black\"))) stop(\"Check specification of 'colset'. Must be either 'color', 'gray', or 'black'.\")\n\n    # set up plots\n\tnc <- dim(postob)[2] #number of chains\n\tnit <- dim(postob)[1] #number of iterations per chain\n\ttnit <- nc*nit  #total iterations\n\texv <- postob[, , vname]\n\tvrng <- range(exv)\n\tchtck <-\n\tif (colset==\"color\") vcv <- rainbow(nc)\n\tif (colset==\"black\") vcv <- rep(\"black\", nc)\n\tif (colset==\"gray\") {\n\t\tglev <- seq(0, 1 - 1/nc, by=1/nc)\n\t\tvcv <- gray(glev)\n\t}\n  if (stack==FALSE){\n  \tif (pscale==\"original\") {\n  \t\tplot(1:tnit, 1:tnit, type=\"n\", ylim=vrng,\n  \t\t\tmain=paste(\"trace of\",vname, \"by chain\") , xlab=\"iteration\", ylab=vname)\n  \t\tfor (ii in 1:nc){\n  \t\t\ttx <- (nit*(ii-1)+1):(ii*nit)\n  \t\t\tlines(tx, exv[ ,ii], lwd=2, col=vcv[ii])\n  \t\t\tif (ii < nc) abline(v=ii*nit, lty=3, col=\"gray30\", lwd=2)\n  \t\t}\n  \t}\n  \tif (pscale==\"log\") {\n  \t\tplot(1:tnit, 1:tnit, type=\"n\", ylim=log(vrng),\n  \t\t\tmain=paste(\"trace of log\",vname, \"by chain\") , xlab=\"iteration\", ylab=paste(\"log\",vname) )\n  \t\tfor (ii in 1:nc){\n  \t\t\ttx <- (nit*(ii-1)+1):(ii*nit)\n  \t\t\tlines(tx, log(exv[ ,ii]), lwd=2, col=vcv[ii])\n  \t\t\tif (ii < nc) abline(v=ii*nit, lty=3, col=\"gray30\", lwd=2)\n  \t\t}\n  \t}\n  \tif (pscale==\"inv\") {\n  \t\tplot(1:tnit, 1:tnit, type=\"n\", ylim=rev(1/vrng),\n  \t\t\tmain=paste(\"trace of inverse\",vname, \"by chain\") , xlab=\"iteration\", ylab=paste(\"1/\",vname,sep=\"\"))\n  \t\tfor (ii in 1:nc){\n  \t\t\ttx <- (nit*(ii-1)+1):(ii*nit)\n  \t\t\tlines(tx, 1/exv[ ,ii], lwd=2, col=vcv[ii])\n  \t\t\tif (ii < nc) abline(v=ii*nit, lty=3, col=\"gray30\", lwd=2)\n  \t\t}\n  \t}\n  } # end stack false\n\tif (stack==TRUE){\n\t\tpar(mfrow=c(4,1), oma=c(2, 2, 2, 0), mar=c(3,2,2,1) )\n\t\tif (pscale==\"original\") {\n\t\t\tfor (ii in 1:nc){\n\t\t\t  plot(1:nit, exv[ ,ii], ylim=vrng, main=\"\", xlab=\"\", ylab=\"\",\n\t\t\t  \ttype=\"l\", lwd=2, col=vcv[ii])\n\t\t\t}\n\t\t\tmtext(side=1, outer=T, line=1, text=\"iteration\")\n\t\t\tmtext(side=2, outer=T, line=1, text=vname)\n\t\t\tmtext(side=3, outer=T, line=1, text=paste(\"trace of\",vname, \"by chain\") )\n\n\t\t}\n\t\tif (pscale==\"log\") {\n\t\t\tfor (ii in 1:nc){\n\t\t\t  plot(1:nit, log(exv[ ,ii]), ylim=log(vrng), main=\"\", xlab=\"\", ylab=\"\",\n\t\t\t  \ttype=\"l\",lwd=2, col=vcv[ii])\n\t\t\t}\n\t\t\tmtext(side=1, outer=T, line=1, text=\"iteration\")\n\t\t\tmtext(side=2, outer=T, line=1, text=paste(\"log\",vname))\n\t\t\tmtext(side=3, outer=T, line=1, text=paste(\"trace of log\",vname, \"by chain\") )\n\t\t}\n\t\tif (pscale==\"inv\") {\n\t\t\tfor (ii in 1:nc){\n\t\t\t  plot(1:nit, 1/exv[ ,ii], ylim=rev(1/vrng), main=\"\", xlab=\"\", ylab=\"\",\n\t\t\t  \ttype=\"l\", lwd=2, col=vcv[ii])\n\t\t\t}\n\t\t\tmtext(side=1, outer=T, line=1, text=\"iteration\")\n\t\t\tmtext(side=2, outer=T, line=1, text=paste(\"1/\",vname,sep=\"\"))\n\t\t\tmtext(side=3, outer=T, line=1, text=paste(\"trace of inverse\",vname, \"by chain\")  )\n\t\t}\n  }  #end stack true\n  par(mfrow=c(1,1), oma=c(0, 0, 0, 0), mar=c(5,4,4,2) )\n\n}\n\n\n",
    "created" : 1450207805422.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3247656174",
    "id" : "9053122A",
    "lastKnownWriteTime" : 1450121754,
    "path" : "~/Classes/Research/packages/bnps/R/plot_trace.r",
    "project_path" : "R/plot_trace.r",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "type" : "r_source"
}