{
    "contents" : "#' Generate function for initial parameter values\n#'\n#' Creates a function for passing to stan which generates initial parameter seeds.\n#' @param prior A character string specifying which prior to use on order-k differences. Choices are \"horseshoe\", \"laplace\", and \"normal\".\n#' @param likelihood A character string specifying the distribution of the observations. Choices are \"normal\", \"poisson\", and \"binomial\".\n#' @param order Numeric value specifying order of differencing (1, 2, or 3).\n#' @return A function for generating initial parameter seeds for passage to stan. Parameters are appropriate to a model with specified prior, likelihood, and order.\n#' @seealso get_model, rstan::stan\n#' @export\n\nget_init <- function(prior=\"horseshoe\", likelihood=\"normal\", order=1) {\n  # prior: (\"horseshoe\", \"laplace\", \"normal\")\n  # likelihood: (\"normal\", \"poisson\", \"binomial\")\n  # order: (1, 2, 3)\n\n\tif (!(prior %in% c(\"horseshoe\", \"laplace\", \"normal\"))) stop(\"Must specify prior of type 'normal', 'laplace' or 'horseshoe'.\")\n  if (!(likelihood %in% c(\"normal\", \"poisson\", \"binomial\"))) stop(\"Must specify likelihood of type 'normal', 'poisson' or 'binomial'.\")\n\tif (!(order %in% c(1,2,3))) stop(\"Model must be of order 1, 2, or 3.\")\n\n  ## --- ORDER 1 --- ##\n\t# Horseshoe\n\tinitf_H_1 <- 'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tztau <- runif(dat$J-1, 0.25, .75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\ttth <- numeric(dat$J)\n\t\ttu <- numeric(dat$J-1)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\tfor (zz in 1:(dat$J-1)){\n\t\t\ttu[zz] <- gm*tan(ztau[zz]*pi/2)\n\t\t\ttth[zz+1] <- zdel[zz]*tu[zz] + tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzgam = zgm,\n\t\t\tztau = ztau,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\ttau = tu\n\t\t\t)\n\t}'\n\n\t##  Laplace (Double Exponential)\n\tinitf_L_1 <- 'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tzta2 <- runif(dat$J-1, 0.25, .75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\ttth <- numeric(dat$J)\n\t\ttu <- numeric(dat$J-1)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\tfor (zz in 1:(dat$J-1)){\n\t\t\ttu[zz] <- gm*sqrt(-2*log(1-zta2[zz]))\n\t\t\ttth[zz+1] <- zdel[zz]*tu[zz] + tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzgam = zgm,\n\t\t\tztau2 = zta2,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\ttau = tu\n\t\t\t)\n\t}'\n\n\n\t## Normal  (GMRF with constant precision)\n\tinitf_N_1 <-  'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\ttth <- numeric(dat$J)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\tfor (zz in 1:(dat$J-1)){\n\t\t\ttth[zz+1] <- gm*zdel[zz] + tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzgam = zgm,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1\n\t\t\t)\n\t}'\n\n\n\t## --- ORDER 2 --- ##\n\t# Horseshoe\n\tinitf_H_2 <- 'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzpt2 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tztau <- runif(dat$J-2, 0.25, .75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\tpt2 <- gm*sqrt(1/3)*tan(zpt2*pi/2)\n\t\ttth <- numeric(dat$J)\n\t\ttu <- numeric(dat$J-2)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\ttth[2] <- pt2*zdel[1] + tth[1]\n\t\tfor (zz in 1:(dat$J-2)){\n\t\t\ttu[zz] <- gm*tan(ztau[zz]*pi/2)\n\t\t\ttth[zz+2] <- zdel[zz+1]*tu[zz] + 2*tth[zz+1]-tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzptau2 = zpt2,\n\t\t\tzgam = zgm,\n\t\t\tztau = ztau,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\tptau2 = pt2,\n\t\t\ttau = tu\n\t\t\t)\n\t}'\n\n\n\n\t##  Laplace (Double Exponential)\n\tinitf_L_2 <- 'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzpt2 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tzta2 <- runif(dat$J-2, 0.25, 0.75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\tpt2 <- gm*sqrt(-(2/3.0)*log(1-zpt2))\n\t\ttth <- numeric(dat$J)\n\t\ttu <- numeric(dat$J-1)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\ttth[2] <- pt2*zdel[1] + tth[1]\n\t\tfor (zz in 1:(dat$J-2)) {\n\t\t\ttu[zz] <- gm*sqrt(-2*log(1-zta2[zz]))\n\t\t\ttth[zz+2] <- zdel[zz+1]*tu[zz] + 2*tth[zz+1]-tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzptau2 = zpt2,\n\t\t\tzgam = zgm,\n\t\t\tztau2 = zta2,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\tptau2 = pt2,\n\t\t\ttau = tu\n\t\t\t)\n\t}'\n\n\t##  Normal (GMRF)\n\tinitf_N_2 <-  'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\tpt2 <- (gm/sqrt(3))\n\t\ttth <- numeric(dat$J)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\ttth[2] <- pt2*zdel[1] + tth[1]\n\t\tfor (zz in 1:(dat$J-2)){\n\t\t\ttth[zz+2] <- gm*zdel[zz+1] + 2*tth[zz+1] - tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzgam = zgm,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\tptau2 = pt2\n\t\t\t)\n\t}'\n\n\n\t## --- ORDER 3 --- ##\n\n\t# Horseshoe\n\tinitf_H_3 <- 'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzpt2 <- runif(1, 0.25, 0.75)\n\t\tzpt3 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tztau <- runif(dat$J-3, 0.25, .75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\tpt2 <- gm*sqrt(1/10)*tan(zpt2*pi/2)\n\t\tpt3 <- gm*sqrt(3/10)*tan(zpt3*pi/2)\n\t\ttth <- numeric(dat$J)\n\t\ttu <- numeric(dat$J-3)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\ttth[2] <- pt2*zdel[1] + tth[1]\n\t\ttth[3] <- pt3*zdel[2] + 2*tth[2] - tth[1]\n\t\tfor (zz in 1:(dat$J-3)){\n\t\t\ttu[zz] <- gm*tan(ztau[zz]*pi/2)\n\t\t\ttth[zz+3] <- zdel[zz+2]*tu[zz] + 3*tth[zz+2] - 3*tth[zz+1] + tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzptau2 = zpt2,\n\t\t\tzptau3 = zpt3,\n\t\t\tzgam = zgm,\n\t\t\tztau = ztau,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\tptau2 = pt2,\n\t\t\tptau3 = pt3,\n\t\t\ttau = tu\n\t\t\t)\n\t}'\n\n\n\t##  Laplace (Double Exponential)\n\tinitf_L_3 <- 'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzpt2 <- runif(1, 0.25, 0.75)\n\t\tzpt3 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tzta2 <- runif(dat$J-3, 0.25, 0.75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\tpt2 <- gm*sqrt(-(1/5.0)*log(1-zpt2))\n\t\tpt3 <- gm*sqrt(-(3/5.0)*log(1-zpt3))\n\t\ttth <- numeric(dat$J)\n\t\ttu <- numeric(dat$J-3)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\ttth[2] <- pt2*zdel[1] + tth[1]\n\t\ttth[3] <- pt3*zdel[2] + 2*tth[2] - tth[1]\n\t\tfor (zz in 1:(dat$J-3)) {\n\t\t\ttu[zz] <- gm*sqrt(-2*log(1-zta2[zz]))\n\t\t\ttth[zz+3] <- zdel[zz+2]*tu[zz] + 3*tth[zz+2] - 3*tth[zz+1] + tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzptau2 = zpt2,\n\t\t\tzptau3 = zpt3,\n\t\t\tzgam = zgm,\n\t\t\tztau2 = zta2,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\tptau2 = pt2,\n\t\t\tptau3 = pt3,\n\t\t\ttau = tu\n\t\t\t)\n\t}'\n\n\t##  Normal (GMRF)\n\tinitf_N_3 <-  'function(chain_id=1, dat=tmp.dat) {\n\t\tLGYSET\n\t\tMUYSET\n\t\tSDYSET\n\t\tZSIGSET\n\t\tzdel <- runif(dat$J-1, -1, 1)\n\t\tzth1 <- runif(1, -1, 1)\n\t\tzm1 <- runif(1, -1, 1)\n\t\tzom1 <- runif(1, 0.25, 0.75)\n\t\tzgm <- runif(1, 0.25, 0.75)\n\t\tSIGSET\n\t\tgm <- 0.1*tan(zgm*pi/2)\n\t\tmt1 <- sdy*zm1 + muy\n\t\tom1 <- tan(zom1*pi/2)\n\t\tpt2 <- gm*sqrt(1/10)\n\t\tpt3 <- gm*sqrt(3/10)\n\t\ttth <- numeric(dat$J)\n\t\ttth[1] <- om1*zth1 + mt1\n\t\ttth[2] <- pt2*zdel[1] + tth[1]\n\t\ttth[3] <- pt3*zdel[2] + 2*tth[2] - tth[1]\n\t\tfor (zz in 1:(dat$J-3)){\n\t\t   tth[zz+3] <- gm*zdel[zz+2] + 3*tth[zz+2] - 3*tth[zz+1] + tth[zz]\n\t\t}\n\t\tlist(ZSIG\n\t\t\tzdelta =  zdel,\n\t\t\tztheta1 = zth1,\n\t\t\tzmuth1 = zm1,\n\t\t\tzomega1 = zom1,\n\t\t\tzgam = zgm,\n\t\t\tSIG\n\t\t\tgam = gm,\n\t\t\ttheta = tth,\n\t\t\tmuth1 = mt1,\n\t\t\tomega1 = om1,\n\t\t\tptau2 = pt2,\n\t\t\tptau3 = pt3,\n\t\t\t)\n\t}'\n\n\t## find model template\n\toptions(scipen=25)\n\tms <- data.frame(matrix(NA, 9, 3))\n\tms[,1] <- c(\"initf_H_1\", \"initf_L_1\", \"initf_N_1\",\n\t\t\t\t\t\t\"initf_H_2\", \"initf_L_2\", \"initf_N_2\",\n\t\t\t\t\t\t\"initf_H_3\", \"initf_L_3\", \"initf_N_3\" )\n\tms[,2] <- rep(1:3,rep(3,3))\n\tms[,3] <- rep(c(\"horseshoe\", \"laplace\", \"normal\"), 3)\n\tnames(ms) <- c(\"modname\", \"order\", \"prior\")\n\tmL <- list(initf_H_1, initf_L_1, initf_N_1,\n\t\t\t\t\t\tinitf_H_2, initf_L_2, initf_N_2,\n\t\t\t\t\t\tinitf_H_3, initf_L_3, initf_N_3 )\n\tnm <- nrow(ms)\n\tmm <- (1:nm)[ms$prior==prior & ms$order==order]\n\ttmp.a <- mL[[mm]]\n\n\n\t# replace likelihood-related statements\n\tif (likelihood==\"normal\"){\n\t\ttmp.b <- sub(\"LGYSET\", \"\", x=tmp.a)\n\t\ttmp.b <- sub(\"MUYSET\", \"muy <- mean(dat$y)\", x=tmp.b)\n\t\ttmp.b <- sub(\"SDYSET\", \"sdy <- sd(dat$y)\", x=tmp.b)\n\t\ttmp.b <- sub(\"ZSIGSET\", \"zsig <- runif(1, .25, .75)\", x=tmp.b)\n\t\ttmp.b <- sub(\"SIGSET\", \"sig <- 5*tan(zsig*pi/2)\", x=tmp.b)\n\t\ttmp.b <- sub(\"ZSIG\", \"zsigma = zsig,\", x=tmp.b)\n\t\ttmp.b <- sub(\"SIG\", \"sigma = sig,\", x=tmp.b)\n\t}\n\n\tif (likelihood==\"poisson\"){\n\t\ttmp.b <- sub(\"LGYSET\", \"\", x=tmp.a)\n\t\ttmp.b <- sub(\"MUYSET\", \"muy <- log(mean(dat$y))\", x=tmp.b)\n\t\ttmp.b <- sub(\"SDYSET\", \"sdy <- sd(log(dat$y))\", x=tmp.b)\n\t\ttmp.b <- sub(\"ZSIGSET\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"SIGSET\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"ZSIG\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"SIG\", \"\", x=tmp.b)\n\t}\n\n\tbintrans <- 'pp <- dat$y/dat$N\n\tpp[pp==0.0] <- 0.005\n\tpp[pp==1.0] <- 0.995\n\tlogitp <- qlogis(pp) \\n'\n\n\n\tif (likelihood==\"binomial\"){\n\t\ttmp.b <- sub(\"LGYSET\", bintrans, x=tmp.a)\n\t\ttmp.b <- sub(\"MUYSET\", \"muy <- qlogis(mean(pp))\", x=tmp.b)\n\t\ttmp.b <- sub(\"SDYSET\", \"sdy <- sd(logitp)\", x=tmp.b)\n\t\ttmp.b <- sub(\"ZSIGSET\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"SIGSET\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"ZSIG\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"SIG\", \"\", x=tmp.b)\n\t}\n\n\n\tptmp <- parse(text=tmp.b)\n\toutf <- eval(ptmp)\n\treturn(outf)\n\n}  #end function\n\n\n\n",
    "created" : 1450201409338.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1428177191",
    "id" : "4FC45A17",
    "lastKnownWriteTime" : 1450203049,
    "path" : "~/Classes/Research/packages/bnps/R/get_init.r",
    "project_path" : "R/get_init.r",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}