{
    "contents" : "#' Generate model code for passage to stan\n#'\n#' Generates a text string of code describing the model of interest for passage to the \\code{stan} function in the rstan package.  This function is called internally in the \\code{bnps} function.\n#' @param prior A character string specifying which prior to use on order-k differences. Choices are \"horseshoe\", \"laplace\", and \"normal\".\n#' @param likelihood A character string specifying the probability distribution of the observation variable. Current choices are \"normal\", \"poisson\", and \"binomial\".\n#' @param order Numeric value specifying order of differencing (1, 2, or 3).\n#' @param zeta The hyperparameter for the global smoothing parameter gamma.  This is the scale parameter of a half-Cauchy distribution.  Smaller values will result in more smoothing depending on the prior specification and the strength of the data. Values must be > 0.\n#' @return A character string of code describing the model of interest for passage to the function \\code{stan} in the \\code{rstan} package.\n#' @details This function can be used to generate a text string containing code in the \\code{stan} model syntax.  This function is called by the \\code{bnps} function internally, so it is not necessary to use \\code{get_model} external to \\code{bnps}.\n#' @seealso bnps, get_init, rstan::stan\n#' @export\n\n\nget_model <- function(prior=\"horseshoe\",  likelihood=\"normal\", order=1,  zeta=0.01){\n\t# prior: (\"horseshoe\", \"laplace\", \"normal\")\n\t# likelihood: (\"normal\", \"poisson\", \"binomial\")\n\t# order: (1, 2, 3)\n\n\tif (!(prior %in% c(\"horseshoe\", \"laplace\", \"normal\"))) stop(\"Must specify prior of type 'normal', 'laplace' or 'horseshoe'.\")\n  if (!(likelihood %in% c(\"normal\", \"poisson\", \"binomial\"))) stop(\"Must specify likelihood of type 'normal', 'poisson' or 'binomial'.\")\n\tif (!(order %in% c(1,2,3))) stop(\"Model must be of order 1, 2, or 3.\")\n\tif (zeta <= 0) stop(\"zeta must be > 0.\")\n\n\t###  MODEL TEMPLATES  #########\n\t# These are modified by the getModel() function before passing to stan\n\n\t###-----  ORDER 1 -----#####\n\n\t###  HORSESHOE PRIOR\n\n\tH_1_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> ztau[J-1];\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\tvector[J-1] tau;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10.0*tan(zomega1*pi()/2);\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\tfor (j in 1:(J-1)){\n\t\t   tau[j] <- gam*tan(ztau[j]*pi()/2);\n\t \t   theta[j+1] <- zdelta[j]*tau[j] + theta[j];\n\t\t}\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tztau ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\t###  LAPLACE PRIOR\n\tL_1_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> ztau2[J-1];\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\tvector[J-1] tau;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10*tan(zomega1*pi()/2);\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\tfor (j in 1:(J-1)){\n\t  \t   tau[j] <- gam*sqrt(-2*log(1-ztau2[j]));\n\t \t   theta[j+1] <- zdelta[j]*tau[j] + theta[j];\n\t\t}\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tztau2 ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\n\t###   NORMAL PRIOR (GMRF)\n\n\tN_1_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10*tan(zomega1*pi()/2);\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\tfor (j in 1:(J-1)){\n\t \t   theta[j+1] <- gam*zdelta[j] + theta[j];\n\t\t}\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\t###-----  ORDER 2 -----#####\n\n\t###  HORSESHOE\n\n\tH_2_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> ztau[J-2];\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\treal <lower=0, upper=1> zptau2;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\treal <lower=0> ptau2;\n\t\tvector[J-2] tau;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10.0*tan(zomega1*pi()/2);\n\t\tptau2 <- (1/sqrt(3.0))*tan(zptau2*pi()/2);\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\ttheta[2] <- ptau2*zdelta[1] + theta[1];\n\t\tfor (j in 1:(J-2)){\n\t   \t   tau[j] <- gam*tan(ztau[j]*pi()/2);\n\t \t   theta[j+2] <- zdelta[j+1]*tau[j] + 2*theta[j+1]-theta[j];\n\t\t}\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tzptau2 ~ uniform(0, 1);\n\t\tztau ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\t###  LAPLACE\n\n\tL_2_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> ztau2[J-2];\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\treal <lower=0, upper=1> zptau2;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\treal <lower=0> ptau2;\n\t\tvector[J-2] tau;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10*tan(zomega1*pi()/2);\n\t\tptau2 <- gam*sqrt(-(2.0/3.0)*log(1-zptau2));\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\ttheta[2] <- ptau2*zdelta[1] + theta[1];\n\t\tfor (j in 1:(J-2)){\n\t\t   tau[j] <- gam*sqrt(-2*log(1-ztau2[j]));\n\t \t   theta[j+2] <- zdelta[j+1]*tau[j] + 2*theta[j+1]-theta[j];\n\t\t}\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tzptau2 ~ uniform(0, 1);\n\t\tztau2 ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\t###   NORMAL\n\tN_2_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\treal <lower=0> ptau2;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10*tan(zomega1*pi()/2);\n\t\tptau2 <- gam*sqrt(1.0/3.0);\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\ttheta[2] <- ptau2*zdelta[1] + theta[1];\n\t\tfor (j in 1:(J-2)){\n\t \t   theta[j+2] <- gam*zdelta[j+1] + 2*theta[j+1]-theta[j];\n\t\t}\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\n\t###-----  ORDER 3 -----#####\n\n\t###  HORSESHOE\n\tH_3_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> ztau[J-3];\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\treal <lower=0, upper=1> zptau2;\n\t\treal <lower=0, upper=1> zptau3;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\treal <lower=0> ptau2;\n\t\treal <lower=0> ptau3;\n\t\tvector[J-3] tau;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10.0*tan(zomega1*pi()/2);\n\t\tptau2 <- gam*sqrt(1.0/10.0)*tan(zptau2*pi()/2);\n\t\tptau3 <- gam*sqrt(3.0/10.0)*tan(zptau3*pi()/2);\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\ttheta[2] <- ptau2*zdelta[1] + theta[1];\n\t\ttheta[3] <- ptau3*zdelta[2] + 2*theta[2] - theta[1];\n\t\tfor (j in 1:(J-3)){\n\t   \t   tau[j] <- gam*tan(ztau[j]*pi()/2);\n\t \t   theta[j+3] <- zdelta[j+2]*tau[j] + 3*theta[j+2] - 3*theta[j+1] + theta[j];\n\t\t}\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tzptau2 ~ uniform(0, 1);\n\t\tzptau3 ~ uniform(0, 1);\n\t\tztau ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\t###  LAPLACE\n\tL_3_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> ztau2[J-3];\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\treal <lower=0, upper=1> zptau2;\n\t\treal <lower=0, upper=1> zptau3;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\treal <lower=0> ptau2;\n\t\treal <lower=0> ptau3;\n\t\tvector[J-3] tau;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10*tan(zomega1*pi()/2);\n\t\tptau2 <- gam*sqrt(-(1.0/5.0)*log(1-zptau2));\n\t\tptau3 <- gam*sqrt(-(3.0/5.0)*log(1-zptau3));\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\ttheta[2] <- ptau2*zdelta[1] + theta[1];\n\t\ttheta[3] <- ptau3*zdelta[2] + 2*theta[2] - theta[1];\n\t\tfor (j in 1:(J-3)){\n\t\t   tau[j] <- gam*sqrt(-2*log(1-ztau2[j]));\n\t \t   theta[j+3] <- zdelta[j+2]*tau[j] + 3*theta[j+2] - 3*theta[j+1] + theta[j];\n\t    }\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tzptau2 ~ uniform(0, 1);\n\t\tzptau3 ~ uniform(0, 1);\n\t\tztau2 ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\n\n\n\t###   NORMAL\n\tN_3_temp <- '\n\t  data {\n\t    int<lower=0> J; // number of observations\n\t\tYSTATE  // response for obs j\n\t\t//NSTATE\n\t  }\n\t  transformed data {\n\t\treal muy;\n\t\treal sdy;\n\t\t//LGYSTATE\n\t\tMUYSTATE\n\t\tSDYSTATE\n\t  }\n\t  parameters {\n\t    real zdelta[J-1];\n\t    real ztheta1;\n\t\treal zmuth1;\n\t\treal <lower=0, upper=1> zgam;\n\t\treal <lower=0, upper=1> zomega1;\n\t\t//SIGPARM\n\t  }\n\t  transformed parameters{\n\t    vector[J] theta;\n\t\treal muth1;\n\t\treal <lower=0> gam;\n\t\treal <lower=0> omega1;\n\t\treal <lower=0> ptau2;\n\t\treal <lower=0> ptau3;\n\t\t//SIGTPARM\n\n\t\t//SIGSET\n\t\tgam <- ZETAVAL*tan(zgam*pi()/2);\n\t\tomega1 <- 10*tan(zomega1*pi()/2);\n\t\tptau2 <- gam*sqrt(1.0/10.0);\n\t\tptau3 <- gam*sqrt(3.0/10.0);\n\t\tmuth1 <- sdy*zmuth1 + muy;\n\t\ttheta[1] <- omega1*ztheta1 + muth1;\n\t\ttheta[2] <- ptau2*zdelta[1] + theta[1];\n\t\ttheta[3] <- ptau3*zdelta[2] + 2*theta[2] - theta[1];\n\t\tfor (j in 1:(J-3)){\n\t \t   theta[j+3] <- gam*zdelta[j+2] + 3*theta[j+2] - 3*theta[j+1] + theta[j];\n\t    }\n\t  }\n\t  model {\n\t\t//ZSIGSTATE\n\t\tzgam ~ uniform(0, 1);\n\t\tzmuth1 ~ normal(0, 1);\n\t\tzomega1 ~ uniform(0, 1);\n\t\tztheta1 ~ normal(0, 1);\n\t\tzdelta ~ normal(0, 1);\n\t\tLIKESTATE\n\t  }\n\t'\n\n\t## find model template\n\toptions(scipen=25)\n\tms <- data.frame(matrix(NA, 9, 3))\n\tms[,1] <- c(\"H_1_temp\", \"L_1_temp\", \"N_1_temp\",\n\t\t\t\t\t\t\"H_2_temp\", \"L_2_temp\", \"N_2_temp\",\n\t\t\t\t\t\t\"H_3_temp\", \"L_3_temp\", \"N_3_temp\" )\n\tms[,2] <- rep(1:3,rep(3,3))\n\tms[,3] <- rep(c(\"horseshoe\", \"laplace\", \"normal\"), 3)\n\tnames(ms) <- c(\"modname\", \"order\", \"prior\")\n\tmL <- list(H_1_temp, L_1_temp, N_1_temp,\n\t\t\t\t\t\tH_2_temp, L_2_temp, N_2_temp,\n\t\t\t\t\t\tH_3_temp, L_3_temp, N_3_temp)\n\tnm <- nrow(ms)\n\tmm <- (1:nm)[ms$prior==prior & ms$order==order]\n\ttmp.a <- mL[[mm]]\n\n\t# replace likelihood-related statements\n\tif (likelihood==\"normal\"){\n\t\ttmp.b <- sub(\"YSTATE\", \"real y[J];\", x=tmp.a)\n\t\ttmp.b <- sub(\"//LGYSTATE\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"//NSTATE\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"MUYSTATE\", \"muy <- mean(y);\", x=tmp.b)\n\t\ttmp.b <- sub(\"SDYSTATE\", \"sdy <- sd(y);\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGPARM\", \"real <lower=0, upper=1> zsigma;\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGTPARM\", \"real <lower=0> sigma;\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGSET\", \"sigma <- 5.0*tan(zsigma*pi()/2);\", x=tmp.b)\n\t\ttmp.b <- sub(\"//ZSIGSTATE\" , \"zsigma ~ uniform(0,1); \", x=tmp.b)\n\t\ttmp.b <- sub(\"LIKESTATE\" , \"y ~ normal(theta, sigma); \", x=tmp.b)\n\t}\n\tif (likelihood==\"poisson\"){\n\t\ttmp.b <- sub(\"YSTATE\", \"int <lower=0> y[J];\", x=tmp.a)\n\t\ttmp.b <- sub(\"//LGYSTATE\", \"real logy[J];\\n real ry[J]; \\n for (j in 1:J) {\\n logy[j] <- log(y[j]+0.5);\\n ry[j] <- 1.0*y[j]; \\n}\\n\", x=tmp.b)\n\t\ttmp.b <- sub(\"//NSTATE\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"MUYSTATE\", \"muy <- log(mean(ry));\", x=tmp.b)\n\t\ttmp.b <- sub(\"SDYSTATE\", \"sdy <- sd(logy);\", x=tmp.b)\n\t\ttmp.b <- sub(\"LIKESTATE\" , \"y ~ poisson_log(theta);\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGPARM\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGTPARM\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGSET\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"//ZSIGSTATE\" , \"\", x=tmp.b)\n\n\t}\n\tbintrans <- 'real <lower=0,upper=1> pp[J];\n\treal logp[J];\n\n\tfor (j in 1:J){\n\t\tpp[j] <- (y[j]+0.0)/(N[j]+0.0);\n\t\tif (pp[j]==0.0)\n\t\t\tpp[j] <- 0.005;\n\t\tif (pp[j]==1.0)\n\t\t\tpp[j] <- 0.995;\n\t\tlogp[j] <- logit(pp[j]);\n\t}'\n\tif (likelihood==\"binomial\"){\n\t\ttmp.b <- sub(\"YSTATE\", \"int <lower=0> y[J];\", x=tmp.a)\n\t\ttmp.b <- sub(\"//LGYSTATE\", bintrans, x=tmp.b)\n\t\ttmp.b <- sub(\"//NSTATE\", \"int <lower=1> N[J];\", x=tmp.b)\n\t\ttmp.b <- sub(\"MUYSTATE\", \"muy <- logit(mean(pp));\", x=tmp.b)\n\t\ttmp.b <- sub(\"SDYSTATE\", \"sdy <- sd(logp);\", x=tmp.b)\n\t\ttmp.b <- sub(\"LIKESTATE\" , \"y ~ binomial_logit(N, theta);\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGPARM\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGTPARM\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"//SIGSET\", \"\", x=tmp.b)\n\t\ttmp.b <- sub(\"//ZSIGSTATE\" , \"\", x=tmp.b)\n\t}\n\n\t## replace gamma\n\ttmp.c <- sub(pattern=\"ZETAVAL\", replacement=zeta, x=tmp.b)\n\treturn(tmp.c)\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1450199839142.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1657064538",
    "id" : "5949735A",
    "lastKnownWriteTime" : 1450200020,
    "path" : "~/Classes/Research/packages/bnps/R/get_model.r",
    "project_path" : "R/get_model.r",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}